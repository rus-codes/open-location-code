# Спецификация Rus Codes

## Входные данные

Rus Codes переводит два числа в одну короткую строку.

Широта и долгота должны быть в фортмате WGS84. Если используются данные в других форматах, то должно быть установлено и четко сформулировано, что это произведет другие местополжения при построении.

## Набор символов

Далее определяется набор сиволов, используемых в Rus Codes. Последовательности, которые содержат прочие символы, по определению не могут быть верными Rus Cod-ами.

### Символы

Символы, используемые в Rus Codes были выбраны так, чтобы их можно было использовать как людям использующим латинский алфавит, так и использующим кириллицу, а так же уменьшить вероятность ошибки при написании.
Ниже приведены символы и их цифровые значения.

|Символ|1|2|3|4|5|6|7|8|9|A|E|K|M|H|O|P|C|T|Y|X|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|Значение|0|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|

### Разделитель форматирования

Символ "+" (U+002B) используется как незначащий символ для улучшения форматирования.

### Добавочный символ

Символы "-" используются как добавочные символы перед разделителем форматирования.

## Кодирование

Символы кода и их порядок не меняются в языках, где письмо происходит справа налево.

Широта должна быть обрезана, чтобы ее значение было в диапазоне от -90 до 90.

Долгота должна быть нормализована, чтобы быть в диапазоне от -180 до 180.

### Наиболее значимые 10 символов

Резьме:
Прибавьте 90 к широте и 180 к долготе, чтобы они стали положительными.
Закодируйте широту и долготу по основанию 20, используя символы выше, 5-тью сиволами каждый, т.е. получив значение размерностью 0.000125.
Начиная с широты, чередуйте символы.

Ниже приведен алгоритм кодирования значиний начиная от наименее значимых символов до наиболее значимых:
1. Прибавьте 90 к широте и 180 к долготе, умнождте оба значения на 8000 и возьмите целую часть от широты и долготы соответственно
1. Приставьте к существующему коду символ, который соответствует целой части широты, взятой по модулю 20 
1. Приставьте к существующему коду символ, который соответствует целой части долготы, взятой по модулю 20
1. Разделите обе, широту и долготу на 20
1. Повторите с шага 2 четырежды

### Наименее значимые 5 символов

Этот способ отличается от приведенного выше тем, что каждый шаг порождает один символ.
Широта кодируется по основанию 5 и долгота -- по основанию 4 и затем символы для каждой позиции комбинируются.

Ниже приведен алгоритм кодирования значений от наименне значимых символов до наиболее значимых:
1. Прибавьте 90 к широте и умножьте дробную часть на 2.5e7 и возьмите целую часть за широту.
1. Прибавьте 180 к долготе, умнождте дробную часть на 8.192e6 и возьмите целую часть за долготу.
1. Возьмите целую часть широты по модулю 5. Умножте полученное значение на 4 и прибавьте целую часть долготы, взятую по модулю 4.
1. Приставьте к существующему коду символ со значением выше.
1. Поделите долготу на 4 и широту на 5
1. Повторите с шага 2 четырежды

### Длина кода

Минимально допустимая длина Rus Cod-a -- два символа.
Максимальная длина Rus Cod-a -- 15 символов.

Коды, короче 10 символов, допустимы только четной длины.

Длина по умолчанию для большинства целей равна 10.

### Форматирование

Разделитель форматирования, должен быть вставлен после 8-ми символов.
Если длина кода меньше 8-ми символов, оставшиеся символы перед разделителем форматирования должны состояить из добавочных символов.

### Точность кода

Нижеследующая таблица показывает точность длин кодов в градусах и метрах. В местах, где точность различается для широты и долготы, указаны обе.

| Длина кода  | Точность в градусах  | Точность         |
| :---------: | :------------------: | :--------------: |
| 2           | 20                   | 2226 км          |
| 4           | 1                    | 111.321 км       |
| 6           | 1/20                 | 5566 метров      |
| 8           | 1/400                | 278 метров       |
| 10          | 1/8000               | 13.9 метров      |
| 11          | 1/40000 x 1/32000    | 2.8 x 3.5 метров |
| 12          | 1/200000 x 1/128000  | 56 x 87 см       |
| 13          | 1/1e6 x 1/512000     | 11 x 22 см       |
| 14          | 1/5e6 x 1/2.048e6    | 2 x 5 см         |
| 15          | 1/2.5e7 x 1/8.192e6  | 4 x 14 мм        |

Эта таблица предполагает, что один градус -- 111321 метр и все расстояния расчитаны на экваторе.

## Декодирование

Координаты получаются декодированием юго-западного угла.
(Северо-восточный угол и центр могут быть получены добавлением значений точности)

Это подразумевает, что северо-востоные координаты не включены в область кода, за исключением кодов, чьи северные широты -- 90 градусов.

## Короткие коды

Короткие коды используются относительно связанного местоположения.
Это позволяет коду быть короче, легче в использовании и запомнинании.

В коротких кодах убраны как минимум два, а как максимум 6 символов сначала полного кода.
Результирующий код должен включать символ "+"(разделитель форматирования).

Коды, которые содержат добавочные символы, не должны быть укорочены.

Символы могут быть удалены из кода, до тех пор пока точность позиции меньше чем в два раза от максимального между широтой и долготой смещения между центром кода и связанным местоположением.
Восстановление оригинального кода должно соответствовать тем же критериям.

Например, у кода 7АТ98Е7А+5У, центр в точке 47.365562,8.524813. Следующая таблица показывает, как код может быть укорочен относительно разных местоположений:

| Связанное местоположение | Сдвиг по широте | Сдвиг по долготе | Двукратный максимальный сдвиг | Код может быть сокрщено до |
| ------------------ | --------------: | ---------------: | ---------------: | -----------------------: |
| 47.373313,8.537562 | 0.008           | 0.013            | 0.025            | 7А+5У                    |
| 47.339563,8.556687 | 0.026           | 0.032            | 0.064            | 8Е7А+5У                  |
| 47.985187,8.440688 | 0.620           | 0.084            | 1.239            | Т98Е7А+5У                |
| 38.800562,-9.064937| 0.620           | 8.565            | 17.590           | 7АТ98Е7А+5У              |

Замечение: Сокращенный код, вовсе не обязательно должен иметь те же начальные 4 символа, как и у связанного местоположения.

## Требования к созданию библиотеки

Библиотека Rus Codes должна предоставлять:
* метод конвертирования широты и долготы в 10-ти значный Rus Code
* метод декодирования 10-ти значного Rus Cod-a в, как минимум, широту и долготу юго-западного угла и ширину и высоту
* метод определения того, что в строка содержит допустимые символы Rus Cod-а
* метод определения того, что в строка -- допустимый полный Rus Code
* методы декодирования и валидации не должны быть регистрозависимыми

Библиотека Rus Codes может предоставлять:
* метод перевода широты и долготы в корректный Rus Code допустимой длины 
* метод декодирования любого корректного Rus Cod-a с дополнительной информацией, такой как центральыне координаты
* метод перевода корректного Rus Cod-a в короткий код, имея связанное местоположение 
* a method to to convert a valid Open Location Code into a short code, given a reference location
* метод восстановления полного кода из короткого кода и связанного местоположения
* метод определения того, что строка -- корректный короткий Rus Code

